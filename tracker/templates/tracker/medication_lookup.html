{% extends "tracker/base.html" %}
{% block title %}Medication Lookup{% endblock %}
{% block content %}
    <div class="container">
        <form id="medicationForm" action="/" method="post" enctype="multipart/form-data" novalidate>
            {% csrf_token %}
            <h1>{{ form.medication_image.help_text|default:"Medication Lookup" }}</h1>
            <div class="fieldWrapper">
                {{ form.medication_image.label_tag }}
                {{ form.medication_image }}
                {{ form.medication_image.errors }}
            </div>
            <input id="submitBtn" type="submit" value="Upload & Process" />
        </form>
        <!-- Loading skeleton -->
        <div id="loadingSkeleton" class="results-container hidden">
            <div class="result-card skeleton-card">
                <div class="skeleton skeleton-title"></div>
                <div class="skeleton skeleton-line"></div>
                <div class="skeleton skeleton-line"></div>
                <div class="skeleton skeleton-line short"></div>
            </div>
        </div>
        {% if messages %}
            <div class="results-container">
                {% for message in messages %}
                    <div class="result-card {{ message.tags }}">
                        <h2 class="result-title">
                            {% if 'error' in message.tags %}
                                Error
                            {% else %}
                                Medication Information
                            {% endif %}
                        </h2>
                        <div class="result-content">{{ message|safe }}</div>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    </div>
    <script>
        document.getElementById('medicationForm').addEventListener('submit', function(e) {
            const submitBtn = document.getElementById('submitBtn');
            const skeleton = document.getElementById('loadingSkeleton');
            
            submitBtn.disabled = true;
            submitBtn.value = 'Processing...';
            skeleton.style.display = 'block';
        });
    </script>
{% endblock %}
